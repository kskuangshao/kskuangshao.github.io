<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>jvm虚拟机探究</title>
    <link href="/2020/11/19/jvm01/"/>
    <url>/2020/11/19/jvm01/</url>
    
    <content type="html"><![CDATA[<h1 id="为什么学习jvm虚拟机"><a href="#为什么学习jvm虚拟机" class="headerlink" title="为什么学习jvm虚拟机"></a>为什么学习jvm虚拟机</h1><ul><li>生产上运行spark的时候时常出现GC OVERHEAD等报错</li><li>作为对于java语言底层（深层）的了解</li></ul><h1 id="JVM探究"><a href="#JVM探究" class="headerlink" title="JVM探究"></a>JVM探究</h1><ul><li><p>谈谈你对jvm的理解？java8虚拟机和之前的变换更新？</p></li><li><p>什么是oom？什么是栈溢出StackOverFlowError？怎么分析？</p></li><li><p>JVM常用调优参数？</p></li><li><p>内存快照如何抓取，怎么分析Dump文件？</p></li><li><p>谈谈JVM中类加载器你的认识？</p><p>jvm中类加载器 rt-jar、ext(扩展jar包)、用户的application</p></li></ul><h2 id="了解"><a href="#了解" class="headerlink" title="了解"></a>了解</h2><ul><li>jvm的位置</li><li>jvm体系结构</li><li>类加载器</li><li>双亲委派机制</li><li>沙箱安全机制</li><li>Native</li><li>PC寄存器、方法区、栈、堆</li><li>三种JVM</li><li>新生代、老年区、永久区</li><li>堆内存调优</li><li>GC 常用算法</li><li>JMM</li><li>总结</li></ul><h3 id="学习方案"><a href="#学习方案" class="headerlink" title="学习方案"></a>学习方案</h3><ul><li>百度</li><li>思维导图 - 在线思维导图去搜索</li></ul><p><img src="D:\hexo\kskuangshaoblog\source_posts\images\image-20201119013059487.png" alt="image-20201119013059487"></p><h4 id="1-类加载器"><a href="#1-类加载器" class="headerlink" title="1. 类加载器"></a>1. 类加载器</h4><ul><li>作用：加载class文件</li></ul><p><img src="D:\hexo\kskuangshaoblog\source_posts\images\image-20201117010051266.png" alt="image-20201117010051266"></p><ol><li>虚拟机自带加载器</li><li>启动类加载器</li><li>扩展类加载器</li><li>应用类加载器</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>jvm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>生产关于hive，sparksql的问题总结</title>
    <link href="/2020/11/19/hive02/"/>
    <url>/2020/11/19/hive02/</url>
    
    <content type="html"><![CDATA[<h1 id="符合分割符的一种解决方案"><a href="#符合分割符的一种解决方案" class="headerlink" title="符合分割符的一种解决方案"></a>符合分割符的一种解决方案</h1><h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><h2 id="DDL数据库定义语言"><a href="#DDL数据库定义语言" class="headerlink" title="DDL数据库定义语言"></a>DDL数据库定义语言</h2><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span>、<span class="hljs-keyword">ALTER</span>、<span class="hljs-keyword">DROP</span>、<span class="hljs-keyword">TRUNCATE</span>、<span class="hljs-keyword">COMMENT</span>、<span class="hljs-keyword">RENAME</span></code></pre><h2 id="DML数据操纵语言"><a href="#DML数据操纵语言" class="headerlink" title="DML数据操纵语言"></a>DML数据操纵语言</h2><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>、<span class="hljs-keyword">INSERT</span>、<span class="hljs-keyword">UPDATE</span>、<span class="hljs-keyword">DELETE</span>、<span class="hljs-keyword">MERGE</span>、<span class="hljs-keyword">CALL</span>、<span class="hljs-keyword">EXPLAIN</span> PLAN<span class="hljs-keyword">LOCK</span> <span class="hljs-keyword">TABLE</span></code></pre><h2 id="DCL数据库控制语言"><a href="#DCL数据库控制语言" class="headerlink" title="DCL数据库控制语言"></a>DCL数据库控制语言</h2><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span>、<span class="hljs-keyword">REVOKE</span></code></pre><h2 id="TCL事务控制语言"><a href="#TCL事务控制语言" class="headerlink" title="TCL事务控制语言"></a>TCL事务控制语言</h2><pre><code class="hljs sql"><span class="hljs-keyword">SAVEPOINT</span>设置保存点、<span class="hljs-keyword">ROLLBACK</span>回滚、<span class="hljs-keyword">SET</span> TRANSCATION</code></pre><h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><h2 id="组合分隔符的解决方案"><a href="#组合分隔符的解决方案" class="headerlink" title="组合分隔符的解决方案"></a>组合分隔符的解决方案</h2><ul><li>建表</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test0001(<span class="hljs-keyword">id</span> <span class="hljs-keyword">string</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">string</span>) <span class="hljs-keyword">ROW</span> <span class="hljs-keyword">FORMAT</span> SERDE <span class="hljs-string">&#x27;org.apache.hadoop.hive.contrib.serde2.MultiDelimitSerDe&#x27;</span> <span class="hljs-keyword">WITH</span> SERDEPROPERTIES (<span class="hljs-string">&quot;field.delim&quot;</span>=<span class="hljs-string">&quot;\&quot;</span>\;\&quot;&quot;);</code></pre><ul><li>添加jar包</li></ul><pre><code class="hljs sql">add jar /usr/local/hive/lib/hive-contrib-1.2.0.jar;</code></pre><ul><li>插入数据</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> test0001 <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;ks&#x27;</span>);</code></pre><ul><li>查询结果</li></ul><pre><code class="hljs shell">1&quot;;&quot;ks</code></pre><h2 id="多表关联查询建表"><a href="#多表关联查询建表" class="headerlink" title="多表关联查询建表"></a>多表关联查询建表</h2><ul><li>方式一（不推荐）</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> Test7<span class="hljs-keyword">as</span> <span class="hljs-keyword">with</span> a <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> player),b <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span>,<span class="hljs-keyword">position</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">position</span>)<span class="hljs-keyword">select</span> a.id,b.name <span class="hljs-keyword">from</span> a,b <span class="hljs-keyword">where</span> a.name=b.name;</code></pre><ul><li>方拾二（推荐）</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> Test8<span class="hljs-keyword">as</span> <span class="hljs-keyword">with</span>a <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> player),b <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span>,<span class="hljs-keyword">position</span> <span class="hljs-keyword">from</span> player)<span class="hljs-keyword">select</span> a.id,b.name,b.position <span class="hljs-keyword">from</span> a<span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">where</span> a.name=b.name;</code></pre><h3 id="spark-sql-查询建表报错"><a href="#spark-sql-查询建表报错" class="headerlink" title="spark-sql 查询建表报错"></a>spark-sql 查询建表报错</h3><pre><code class="hljs pgsql">Caused <span class="hljs-keyword">by</span>: org.apache.spark.<span class="hljs-keyword">sql</span>.catalyst.<span class="hljs-keyword">parser</span>.ParseException: Datatype <span class="hljs-type">void</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> supported原因：Spark不支持Hive表中的<span class="hljs-type">void</span>字段类型，代码中临时<span class="hljs-keyword">create</span>的Hive表中，如果<span class="hljs-keyword">from</span>的源表中某字段为全空值，则<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span>时该临时表的这个字段类型就会变成<span class="hljs-type">void</span>。</code></pre><pre><code class="hljs angelscript">解决方法：如果是上面这种情况，可以用Hive跑任务或者修改该Hive表的字段类型不为<span class="hljs-built_in">void</span>，或将<span class="hljs-literal">null</span>转换为<span class="hljs-built_in">string</span>等。</code></pre><h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><h2 id="输入数据并动态分区"><a href="#输入数据并动态分区" class="headerlink" title="输入数据并动态分区"></a>输入数据并动态分区</h2><pre><code class="hljs sql"><span class="hljs-comment">--案例：比方说一个订单表，按照品牌（pt_brand_x）分区</span><span class="hljs-keyword">insert</span> overwrite <span class="hljs-keyword">table</span> app.sbl_order <span class="hljs-keyword">partition</span>(pt_brand_x) <span class="hljs-comment">--动态分区</span><span class="hljs-keyword">select</span> order_id,       order_price,       pt_biz_date,       pt_brand_x <span class="hljs-comment">--动态分区字段放最后</span><span class="hljs-keyword">from</span> <span class="hljs-keyword">order</span>;</code></pre><h2 id="常用的函数"><a href="#常用的函数" class="headerlink" title="常用的函数"></a>常用的函数</h2><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> pt_brand_x     <span class="hljs-keyword">AS</span> pt_brand_x, integration_id <span class="hljs-keyword">AS</span> integration_id, position_name  <span class="hljs-keyword">AS</span> position_name, row_wid        <span class="hljs-keyword">AS</span> row_wid, emp_last_name  <span class="hljs-keyword">AS</span> emp_last_name, <span class="hljs-keyword">CASE</span> <span class="hljs-comment">--position_name 长度小于10</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">length</span>(position_name) &lt; <span class="hljs-number">10</span> <span class="hljs-keyword">THEN</span> position_name <span class="hljs-comment">--instr函数代替了like方式，返回字符串在字段中的位置，没有为0 </span> <span class="hljs-comment">--神经病，精神病，病 ,查 神 返回1 2 0 </span> <span class="hljs-comment">--也可以放到where里&gt;0查看字段里是否存在这个字</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">instr</span>(<span class="hljs-keyword">upper</span>(position_name), <span class="hljs-string">&#x27;LANCOME&#x27;</span>) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> position_name <span class="hljs-keyword">WHEN</span> position_name = <span class="hljs-string">&#x27;LAN_CN_Position&#x27;</span> <span class="hljs-keyword">THEN</span> position_name <span class="hljs-comment">--从第4个位置开始保留到最后</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">substr</span>(position_name, <span class="hljs-number">4</span>) <span class="hljs-keyword">END</span>        <span class="hljs-keyword">AS</span> new_ba_code<span class="hljs-keyword">FROM</span> dws.mirror_dim_sbl_w_position_d<span class="hljs-keyword">WHERE</span> <span class="hljs-number">1</span> = <span class="hljs-number">1</span>;</code></pre><h1 id="sparksql问题"><a href="#sparksql问题" class="headerlink" title="sparksql问题"></a>sparksql问题</h1><h2 id="GC-overhead"><a href="#GC-overhead" class="headerlink" title="GC overhead"></a>GC overhead</h2><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><pre><code class="hljs"><span class="hljs-attribute">java.lang.OutOfMemoryError</span>: GC overhead limit exceeded 这种情况发生的原因是, 程序基本上耗尽了所有的可用内存, GC也清理不了。JVM抛出 java.lang.OutOfMemoryError: GC overhead limit exceeded 错误就是发出了这样的信号: 执行垃圾收集的时间比例太大, 有效的运算量太小. 默认情况下, 如果GC花费的时间超过 98%, 并且GC回收的内存少于 2%, JVM就会抛出这个错误。</code></pre><h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><h4 id="创建分区表，限制分区插入"><a href="#创建分区表，限制分区插入" class="headerlink" title="创建分区表，限制分区插入"></a>创建分区表，限制分区插入</h4><pre><code class="hljs powershell">关于数据量大插入慢的问题：可以使用分区表，按照品牌分区，如果一次吧所有品牌插入出现<span class="hljs-built_in">GC</span> overhead，其他报错等问题，可以通过限制品牌分批插入。</code></pre><h4 id="发生到executor之后"><a href="#发生到executor之后" class="headerlink" title="发生到executor之后"></a>发生到executor之后</h4><ul><li>参数</li></ul><pre><code class="hljs shell">spark-sql \--master yarn \--deploy-mode client \--executor-cores 1 \--executor-memory 8G \--driver-memory 8G \--queue root.hypers.adhoc \--conf spark.yarn.executor.memoryoverhead=2048m \--conf spark.storage.memoryFraction=0.4 \--conf spark.hadoop.hive.cli.print.header=true \--conf spark.sql.shuffle.partitions=500 \--conf spark.dynamicAllocation.enabled=true \--conf spark.sql.autoBroadcastJoinThreshold=-1 \--conf spark.dynamicAllocation.maxExecutors=80 \--conf spark.driver.maxResultSize=4g \--hiveconf hive.exec.dynamic.partition=true \--hiveconf hive.exec.dynamic.partition.mode=nonstrict \--hiveconf hive.exec.max.dynamic.partitions=10000 \--hiveconf hive.exec.max.dynamic.partitions.pernode=10000 \--hiveconf spark.debug.maxToStringFields=200 \-f lrl.sql</code></pre><ul><li>现象</li></ul><pre><code class="hljs angelscript">--此阶段executor端--(<span class="hljs-number">7029</span>/<span class="hljs-number">7037</span>)代表task（未完成/已完成）的数量<span class="hljs-number">20</span>/<span class="hljs-number">11</span>/<span class="hljs-number">11</span> <span class="hljs-number">23</span>:<span class="hljs-number">55</span>:<span class="hljs-number">22</span> INFO scheduler.TaskSetManager: Finished task <span class="hljs-number">7000.0</span> <span class="hljs-keyword">in</span> stage <span class="hljs-number">0.0</span> (TID <span class="hljs-number">7000</span>) <span class="hljs-keyword">in</span> <span class="hljs-number">13864</span> ms on worker32.loreal.com (executor <span class="hljs-number">5</span>) (<span class="hljs-number">7029</span>/<span class="hljs-number">7037</span>)--个人理解如果在executor端出现gc，应该是executor-memory的问题如果发生在<span class="hljs-number">20</span>/<span class="hljs-number">11</span>/<span class="hljs-number">11</span> <span class="hljs-number">23</span>:<span class="hljs-number">55</span>:<span class="hljs-number">47</span> INFO spark.ContextCleaner: Cleaned accumulator <span class="hljs-number">11</span><span class="hljs-number">20</span>/<span class="hljs-number">11</span>/<span class="hljs-number">11</span> <span class="hljs-number">23</span>:<span class="hljs-number">59</span>:<span class="hljs-number">08</span> INFO spark.ExecutorAllocationManager: Request to remove executorIds: <span class="hljs-number">45</span>, <span class="hljs-number">30</span>, <span class="hljs-number">39</span>, <span class="hljs-number">51</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">48</span>, <span class="hljs-number">33</span>, <span class="hljs-number">27</span>, <span class="hljs-number">12</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">42</span>, <span class="hljs-number">36</span>, <span class="hljs-number">21</span>, <span class="hljs-number">18</span>, <span class="hljs-number">24</span>, <span class="hljs-number">41</span>, <span class="hljs-number">35</span>, <span class="hljs-number">7</span>, <span class="hljs-number">17</span>, <span class="hljs-number">1</span>, <span class="hljs-number">44</span>, <span class="hljs-number">50</span>, <span class="hljs-number">23</span>, <span class="hljs-number">38</span>, <span class="hljs-number">47</span>, <span class="hljs-number">26</span>, <span class="hljs-number">4</span>, <span class="hljs-number">11</span>, <span class="hljs-number">32</span>, <span class="hljs-number">1</span>之后则是driver-memory的问题</code></pre><ul><li>尝试通过提高driver端的内存</li></ul><pre><code class="hljs shell">--conf driver-memory 10G</code></pre><ul><li>driver堆外内存</li></ul><pre><code class="hljs shell">--spark.driver.memoryOverhead=2048m</code></pre><ul><li>executor-core的数量太多，导致多个core之间争夺GC时间以及资源，最后大部分时间都花到了gc上</li></ul><pre><code class="hljs ada"><span class="hljs-comment">--executor-cores 1</span></code></pre><h4 id="关于一些资料的总结"><a href="#关于一些资料的总结" class="headerlink" title="关于一些资料的总结"></a>关于一些资料的总结</h4><pre><code class="hljs apache"><span class="hljs-attribute">executor</span>-cores cores越多，能快速的执行分配给自己的task 建议<span class="hljs-number">2</span>-<span class="hljs-number">4</span>个<span class="hljs-attribute">driver</span>-memory默认<span class="hljs-number">1</span>g，如果使用collect算子，那么会将rdd算子全部拉到driver上执行，确保driver内存足够大，否则oom<span class="hljs-attribute">spark</span>.default.parallelism = num-executors*executor-cores*<span class="hljs-number">2</span>-<span class="hljs-number">3</span> 并行度<span class="hljs-attribute">spark</span>.storage.memoryFraction executor中用于持久化的比例，默认<span class="hljs-number">0</span>.<span class="hljs-number">6</span><span class="hljs-attribute">spark</span>.shuffle.memoryFraction 用来进行shuffle(read)操作的内存比例，默认<span class="hljs-number">0</span>.<span class="hljs-number">2</span></code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>hive</tag>
      
      <tag>生产</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tez</title>
    <link href="/2020/10/28/tez/"/>
    <url>/2020/10/28/tez/</url>
    
    <content type="html"><![CDATA[<h1 id="tez官网"><a href="#tez官网" class="headerlink" title="tez官网"></a>tez官网</h1><pre><code class="hljs sql">http://tez.apache.org/</code></pre><h1 id="什么是Tez？"><a href="#什么是Tez？" class="headerlink" title="什么是Tez？"></a>什么是Tez？</h1><p>tez是一个基于内存的计算引擎，通过允许像 Apache Hive 和 Apache Pig 这样的项目运行复杂的 DAG 任务，Tez 可用于处理数据。</p><ul><li>优点：快，节点少</li><li>缺点：对内存要求高</li></ul><h1 id="Tez安装部署"><a href="#Tez安装部署" class="headerlink" title="Tez安装部署"></a>Tez安装部署</h1><ol><li>查看官网选择和hadoop匹配的tez版本</li></ol><pre><code class="hljs applescript">hadoop <span class="hljs-built_in">version</span></code></pre><ol start="2"><li>下载</li></ol><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.apache.org<span class="hljs-regexp">/dyn/</span>closer.lua<span class="hljs-regexp">/tez/</span><span class="hljs-number">0.8</span>.<span class="hljs-number">5</span>/</code></pre><ol start="3"><li>解压</li></ol><ul><li>注意：解压到hive的节点上</li></ul><ol start="4"><li>下载的tez包（ apache-tez-0.8.5-bin.tar.gz） 上传到hdfs上</li></ol><ul><li>除了hive节点，其他节点也需要tez计算</li></ul><p>5. </p>]]></content>
    
    
    
    <tags>
      
      <tag>hive	tez</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql函数</title>
    <link href="/2020/10/28/sql01/"/>
    <url>/2020/10/28/sql01/</url>
    
    <content type="html"><![CDATA[<h1 id="总结常用sql函数"><a href="#总结常用sql函数" class="headerlink" title="总结常用sql函数"></a>总结常用sql函数</h1><h2 id="1-unix-timestamp-amp-from-unixtime"><a href="#1-unix-timestamp-amp-from-unixtime" class="headerlink" title="1.unix_timestamp &amp; from_unixtime()"></a>1.unix_timestamp &amp; from_unixtime()</h2><ul><li>unix_timestamp</li></ul><pre><code class="hljs sql">spark-sql&gt; select unix_timestamp(&#x27;2018-12-05 01:10:00&#x27;,&#x27;yyyy-MM-dd HH:mm:ss&#x27;);1543943400</code></pre> <pre><code class="hljs sql">spark-sql&gt; select unix_timestamp(&#x27;2018-12-05&#x27;,&#x27;yyyy-MM-dd&#x27;);1543939200</code></pre><ul><li>from_unixtime()</li></ul><pre><code class="hljs sql">spark-sql&gt; select from_unixtime(1543943400,&#x27;yyyy-MM-dd&#x27;);2018-12-05</code></pre><h2 id="2-cast-name-as-string-类型转换"><a href="#2-cast-name-as-string-类型转换" class="headerlink" title="2. cast(name as string) 类型转换"></a>2. cast(name as string) 类型转换</h2><ul><li>cnt int –&gt; cnt string</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">cast</span>(cnt <span class="hljs-keyword">as</span> <span class="hljs-keyword">string</span>) <span class="hljs-keyword">from</span> player;</code></pre><h2 id="3-if-name-’ks’-x-y"><a href="#3-if-name-’ks’-x-y" class="headerlink" title="3. if(name=’ks’,x,y)"></a>3. if(name=’ks’,x,y)</h2><ul><li>如果name字段是ks，返回x，否则返回y</li></ul><h2 id="4-hive中map类型的字段使用"><a href="#4-hive中map类型的字段使用" class="headerlink" title="4. hive中map类型的字段使用"></a>4. hive中map类型的字段使用</h2><ul><li>创建表</li><li>注意集合，key的分隔符</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> player_info (groupname <span class="hljs-keyword">string</span>,info <span class="hljs-keyword">map</span>&lt;<span class="hljs-keyword">string</span>,<span class="hljs-keyword">string</span>&gt;)<span class="hljs-keyword">ROW</span> <span class="hljs-keyword">FORMAT</span> <span class="hljs-keyword">DELIMITED</span>                                          <span class="hljs-keyword">FIELDS</span> <span class="hljs-keyword">TERMINATED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;\t&#x27;</span>                                COLLECTION ITEMS <span class="hljs-keyword">TERMINATED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;,&#x27;</span>                       <span class="hljs-keyword">MAP</span> <span class="hljs-keyword">KEYS</span> <span class="hljs-keyword">TERMINATED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;:&#x27;</span>;</code></pre><ul><li>文本数据准备</li><li>player_info.txt</li></ul><pre><code class="hljs css"><span class="hljs-selector-tag">win_team</span><span class="hljs-selector-tag">name</span><span class="hljs-selector-pseudo">:ks</span>,<span class="hljs-selector-tag">age</span><span class="hljs-selector-pseudo">:18</span>,<span class="hljs-selector-tag">position</span><span class="hljs-selector-pseudo">:carry</span><span class="hljs-selector-tag">win_team</span><span class="hljs-selector-tag">name</span><span class="hljs-selector-pseudo">:ajshon</span>,<span class="hljs-selector-tag">age</span><span class="hljs-selector-pseudo">:19</span>,<span class="hljs-selector-tag">position</span><span class="hljs-selector-pseudo">:mid</span><span class="hljs-selector-tag">lose_team</span><span class="hljs-selector-tag">name</span><span class="hljs-selector-pseudo">:rain</span>,<span class="hljs-selector-tag">age</span><span class="hljs-selector-pseudo">:28</span>,<span class="hljs-selector-tag">position</span><span class="hljs-selector-pseudo">:top</span></code></pre><ul><li>导入数据到表</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">load</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">local</span> inpath <span class="hljs-string">&#x27;/home/hadoop/data/player_info.txt&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> player_info;</code></pre><ul><li>查询</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">select</span> info[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">from</span> player_info;</code></pre><ul><li>结果</li></ul><pre><code class="hljs apache"><span class="hljs-attribute">Driver</span>.java:<span class="hljs-number">376</span>, took <span class="hljs-number">0</span>.<span class="hljs-number">719682</span> s<span class="hljs-attribute">ks</span><span class="hljs-attribute">ajshon</span><span class="hljs-attribute">rain</span></code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql语句</title>
    <link href="/2020/10/28/sql02/"/>
    <url>/2020/10/28/sql02/</url>
    
    <content type="html"><![CDATA[<h1 id="总结常用sql语句"><a href="#总结常用sql语句" class="headerlink" title="总结常用sql语句"></a>总结常用sql语句</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>建表语句</p><ul><li>多表结构相同</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">tables</span> <span class="hljs-keyword">as</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> player1<span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> player2;</code></pre><ul><li>多表结构不相同</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tables2<span class="hljs-keyword">as</span> <span class="hljs-keyword">with</span>a <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> player1),b <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,age <span class="hljs-keyword">from</span> player2)<span class="hljs-keyword">select</span> a.id,a.name,b.age <span class="hljs-keyword">from</span> a,b <span class="hljs-keyword">where</span> a.id=b.id;</code></pre><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tables3<span class="hljs-keyword">as</span> <span class="hljs-keyword">with</span>a <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> player1),b <span class="hljs-keyword">as</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,age <span class="hljs-keyword">from</span> player2)<span class="hljs-keyword">select</span> a.id,a.name,b.age <span class="hljs-keyword">from</span> a<span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span>b <span class="hljs-keyword">on</span> a.id=b.id;</code></pre><h2 id="元数据-和-建表语句-分开"><a href="#元数据-和-建表语句-分开" class="headerlink" title="元数据 和 建表语句 分开"></a>元数据 和 建表语句 分开</h2><h3 id="方式一（hdfs）"><a href="#方式一（hdfs）" class="headerlink" title="方式一（hdfs）"></a>方式一（hdfs）</h3><ul><li>元数据test.txt上传hdfs</li></ul><pre><code class="hljs awk">hdfs dfs -put test.txt <span class="hljs-regexp">/hive/</span>test/</code></pre><ul><li>建表指定位置</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> player4(<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">string</span>) <span class="hljs-keyword">row</span> <span class="hljs-keyword">format</span> <span class="hljs-keyword">delimited</span> <span class="hljs-keyword">fields</span> <span class="hljs-keyword">terminated</span> <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;\t&#x27;</span> location <span class="hljs-string">&#x27;/hive/test&#x27;</span>;</code></pre><h3 id="方式二（load方式，本地、hdfs）"><a href="#方式二（load方式，本地、hdfs）" class="headerlink" title="方式二（load方式，本地、hdfs）"></a>方式二（load方式，本地、hdfs）</h3><ul><li>建表</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> player4(<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">string</span>) <span class="hljs-keyword">row</span> <span class="hljs-keyword">format</span> <span class="hljs-keyword">delimited</span> <span class="hljs-keyword">fields</span> <span class="hljs-keyword">terminated</span> <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;\t&#x27;</span></code></pre><ul><li>元数据load到表中(“[ ]”代表可选)</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">load</span> <span class="hljs-keyword">data</span> [<span class="hljs-keyword">local</span>] inpath <span class="hljs-string">&#x27;/home/hadoop/data/test.txt&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> player4</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hive数据类型、语法、分区表等概念</title>
    <link href="/2020/10/26/hive01/"/>
    <url>/2020/10/26/hive01/</url>
    
    <content type="html"><![CDATA[<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><table><thead><tr><th>Hive数据类型</th><th>java数据类型</th><th>长度</th><th>例子</th></tr></thead><tbody><tr><td>TinyInt</td><td>byte</td><td>1byte有符号整数</td><td>20</td></tr><tr><td>SmallInt</td><td>short</td><td>2byte有符号整数</td><td>20</td></tr><tr><td>Int</td><td>int</td><td>4byte有符号整数</td><td>20</td></tr><tr><td>BigInt</td><td>long</td><td>8byte有符号整数</td><td>20</td></tr><tr><td>Boolean</td><td>boolean</td><td>布尔类型</td><td>true，false</td></tr><tr><td>Float</td><td>float</td><td>单精度浮点数</td><td>3.14159</td></tr><tr><td>Double</td><td>double</td><td>双精度浮点数</td><td>3.14159</td></tr><tr><td>String</td><td>string</td><td>字符</td><td>‘now is time’</td></tr><tr><td>Timestamp</td><td></td><td>时间类型</td><td></td></tr><tr><td>binary</td><td></td><td>字节数组</td><td></td></tr></tbody></table><ul><li>hive中的string相当于数据库的varchar，理论上能存2G的字符串</li><li>小转大，不能大转小</li><li>string、float可以隐式转换成double</li><li>tinyint、smallint、int可以转换为float</li><li>boolean类型不能转换为其他类型</li><li>强制类型转换，可以使用CAST(1 AS INT)把字符串’1’转换成整数1，㘝强制类型转换失败，返回NULL</li></ul><h1 id="DDL数据定义"><a href="#DDL数据定义" class="headerlink" title="DDL数据定义"></a>DDL数据定义</h1><h2 id="库的增删改查"><a href="#库的增删改查" class="headerlink" title="库的增删改查"></a>库的增删改查</h2><h3 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h3><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> mydb;</code></pre><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> mydb location <span class="hljs-string">&#x27;/db_hive2.db&#x27;</span>;</code></pre><h3 id="2-删除数据库"><a href="#2-删除数据库" class="headerlink" title="2. 删除数据库"></a>2. 删除数据库</h3><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> mydb;</code></pre><ul><li>删除不为空的database</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> mydb <span class="hljs-keyword">cascade</span>;</code></pre><h3 id="3-查看数据库"><a href="#3-查看数据库" class="headerlink" title="3. 查看数据库"></a>3. 查看数据库</h3><ul><li>模糊查询</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">databases</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;db_hive*&#x27;</span>;</code></pre><ul><li>查看数据库详细信息</li></ul><pre><code class="hljs pgsql"><span class="hljs-keyword">desc</span> <span class="hljs-keyword">database</span> extended db_hive;</code></pre><h3 id="4-修改数据库"><a href="#4-修改数据库" class="headerlink" title="4. 修改数据库"></a>4. 修改数据库</h3><ul><li>注意：元数据信息不能更改（数据库名，数据库所在位置）</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">database</span> db_hive <span class="hljs-keyword">set</span> dbproperties(<span class="hljs-string">&#x27;createtime&#x27;</span>=<span class="hljs-string">&#x27;20200808&#x27;</span>)</code></pre><h2 id="表的增删改查"><a href="#表的增删改查" class="headerlink" title="表的增删改查"></a>表的增删改查</h2><h3 id="1-建表语句"><a href="#1-建表语句" class="headerlink" title="1. 建表语句"></a>1. 建表语句</h3><ul><li>分区分的是文件夹，分桶分的是文件（对应partitioned by、clustered by）</li><li>‘[ ]’表示可选，’|’表示二选一</li><li>指定分隔符</li></ul><pre><code class="hljs sql">row format delimited fields terminated by &#x27;/t&#x27;</code></pre><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">TEMPORARY</span>] [<span class="hljs-keyword">EXTERNAL</span>] <span class="hljs-keyword">TABLE</span> [<span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] [db_name.]table_name  [(col_name data_type [<span class="hljs-keyword">COMMENT</span> col_comment], ... [constraint_specification])]  [<span class="hljs-keyword">COMMENT</span> table_comment]  [PARTITIONED <span class="hljs-keyword">BY</span> (col_name data_type [<span class="hljs-keyword">COMMENT</span> col_comment], ...)]  [CLUSTERED <span class="hljs-keyword">BY</span> (col_name, col_name, ...) [SORTED <span class="hljs-keyword">BY</span> (col_name [<span class="hljs-keyword">ASC</span>|<span class="hljs-keyword">DESC</span>], ...)] <span class="hljs-keyword">INTO</span> num_buckets BUCKETS]  [SKEWED <span class="hljs-keyword">BY</span> (col_name, col_name, ...)     <span class="hljs-keyword">ON</span> ((col_value, col_value, ...), (col_value, col_value, ...), ...)     [<span class="hljs-keyword">STORED</span> <span class="hljs-keyword">AS</span> DIRECTORIES]  [   [<span class="hljs-keyword">ROW</span> <span class="hljs-keyword">FORMAT</span> row_format]    [<span class="hljs-keyword">STORED</span> <span class="hljs-keyword">AS</span> file_format]     | <span class="hljs-keyword">STORED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;storage.handler.class.name&#x27;</span> [<span class="hljs-keyword">WITH</span> SERDEPROPERTIES (...)]  ]  [LOCATION hdfs_path]</code></pre><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">TEMPORARY</span>] [<span class="hljs-keyword">EXTERNAL</span>] <span class="hljs-keyword">TABLE</span> [<span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] [db_name.]table_name    <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> TEMPORARY available in Hive 0.14.0 and later)</span>  [(col_name data_type [<span class="hljs-keyword">COMMENT</span> col_comment], ... [constraint_specification])]  [<span class="hljs-keyword">COMMENT</span> table_comment]  [PARTITIONED <span class="hljs-keyword">BY</span> (col_name data_type [<span class="hljs-keyword">COMMENT</span> col_comment], ...)]  [CLUSTERED <span class="hljs-keyword">BY</span> (col_name, col_name, ...) [SORTED <span class="hljs-keyword">BY</span> (col_name [<span class="hljs-keyword">ASC</span>|<span class="hljs-keyword">DESC</span>], ...)] <span class="hljs-keyword">INTO</span> num_buckets BUCKETS]  [SKEWED <span class="hljs-keyword">BY</span> (col_name, col_name, ...)                  <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.10.0 and later)]</span>     <span class="hljs-keyword">ON</span> ((col_value, col_value, ...), (col_value, col_value, ...), ...)     [<span class="hljs-keyword">STORED</span> <span class="hljs-keyword">AS</span> DIRECTORIES]  [   [<span class="hljs-keyword">ROW</span> <span class="hljs-keyword">FORMAT</span> row_format]    [<span class="hljs-keyword">STORED</span> <span class="hljs-keyword">AS</span> file_format]     | <span class="hljs-keyword">STORED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;storage.handler.class.name&#x27;</span> [<span class="hljs-keyword">WITH</span> SERDEPROPERTIES (...)]  <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.6.0 and later)</span>  ]  [LOCATION hdfs_path]  [TBLPROPERTIES (property_name=property_value, ...)]   <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.6.0 and later)</span>   [<span class="hljs-keyword">AS</span> select_statement];   <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.5.0 and later; not supported for external tables)</span>   <span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">TEMPORARY</span>] [<span class="hljs-keyword">EXTERNAL</span>] <span class="hljs-keyword">TABLE</span> [<span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] [db_name.]table_name  <span class="hljs-keyword">LIKE</span> existing_table_or_view_name  [LOCATION hdfs_path]; data_type  : primitive_type  | array_type  | map_type  | struct_type  | union_type  <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.7.0 and later)</span> primitive_type  : TINYINT  | SMALLINT  | INT  | BIGINT  | BOOLEAN  | FLOAT  | DOUBLE  | DOUBLE PRECISION <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 2.2.0 and later)</span>  | STRING  | BINARY      <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.8.0 and later)</span>  | TIMESTAMP   <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.8.0 and later)</span>  | DECIMAL     <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.11.0 and later)</span>  | DECIMAL(precision, scale)  <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.13.0 and later)</span>  | DATE        <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.12.0 and later)</span>  | VARCHAR     <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.12.0 and later)</span>  | CHAR        <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.13.0 and later)</span> array_type  : ARRAY &lt; data_type &gt; map_type  : MAP &lt; primitive_type, data_type &gt; struct_type  : STRUCT &lt; col_name : data_type [COMMENT col_comment], ...&gt; union_type   : UNIONTYPE &lt; data_type, data_type, ... &gt;  -- (Note: Available in Hive 0.7.0 and later) row_format  : DELIMITED [FIELDS TERMINATED BY char [ESCAPED BY char]] [COLLECTION ITEMS TERMINATED BY char]        [MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]        [NULL DEFINED AS char]   <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.13 and later)</span>  | SERDE serde_name [<span class="hljs-keyword">WITH</span> SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)] file_format:  : SEQUENCEFILE  | TEXTFILE    <span class="hljs-comment">-- (Default, depending on hive.default.fileformat configuration)</span>  | RCFILE      <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.6.0 and later)</span>  | ORC         <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.11.0 and later)</span>  | PARQUET     <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.13.0 and later)</span>  | AVRO        <span class="hljs-comment">-- (<span class="hljs-doctag">Note:</span> Available in Hive 0.14.0 and later)</span>  | INPUTFORMAT input_format_classname OUTPUTFORMAT output_format_classname constraint_specification:  : [, PRIMARY <span class="hljs-keyword">KEY</span> (col_name, ...) <span class="hljs-keyword">DISABLE</span> <span class="hljs-keyword">NOVALIDATE</span> ]    [, <span class="hljs-keyword">CONSTRAINT</span> constraint_name <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (col_name, ...) <span class="hljs-keyword">REFERENCES</span> table_name(col_name, ...) <span class="hljs-keyword">DISABLE</span> <span class="hljs-keyword">NOVALIDATE</span></code></pre><h3 id="2-修改表"><a href="#2-修改表" class="headerlink" title="2. 修改表"></a>2. 修改表</h3><ul><li>重命名表</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student4 <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> student;</code></pre><ul><li>增删改分区</li></ul><p>见如下分区表</p><ul><li>增加、修改、替换列信息</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student4 <span class="hljs-keyword">add</span> <span class="hljs-keyword">columns</span>(<span class="hljs-keyword">name</span> <span class="hljs-keyword">string</span>);</code></pre><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student4 <span class="hljs-keyword">change</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">names</span> <span class="hljs-keyword">string</span>;</code></pre><pre><code class="hljs sql"><span class="hljs-comment">--替换所有列</span><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student4 <span class="hljs-keyword">replace</span> <span class="hljs-keyword">columns</span>(did <span class="hljs-built_in">int</span>);</code></pre><h2 id="内部表和外部表区别"><a href="#内部表和外部表区别" class="headerlink" title="内部表和外部表区别"></a>内部表和外部表区别</h2><ol><li>删除表内部表的元数据也会删除，外部表则不会</li><li>建表语句不同，外部表有external关键字</li></ol><ul><li><p>内部表也叫管理表</p></li><li><p>内部表转外部表（大写！）</p></li></ul><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student2 <span class="hljs-keyword">set</span> tblproperties(<span class="hljs-string">&#x27;EXTERNAL&#x27;</span>=<span class="hljs-string">&#x27;TURE&#x27;</span>);</code></pre><ul><li>然后查询一下</li></ul><pre><code class="hljs sql">desc formatted student2;</code></pre><h2 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h2><p>hive的分区表就是分目录，把一个大的数据集根据业务需要分割成小的数据集，在查询的时候通过WHERE子句中的表达选择所需要的的指定分区，这样查询效率高。谓词下推</p><ul><li>谓词下推：先过滤成小数据集，再查询，效率高。</li><li>分区字段也是表中的一个字段，只不过比较特殊。（不能使用表属性名作为分区字段名，自行体会）</li></ul><h3 id="一级分区"><a href="#一级分区" class="headerlink" title="一级分区"></a>一级分区</h3><ol><li>增加分区</li></ol><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;202008&#x27;</span>) <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;202009&#x27;</span>);</code></pre><ol start="2"><li>删除分区</li></ol><ul><li>注意这里是’ , ‘</li></ul><pre><code class="hljs sql">alte table student <span class="hljs-keyword">drop</span> <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;202008&#x27;</span>) ,<span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;202009&#x27;</span>);</code></pre><ol start="3"><li>查看分区表有多少个分区</li></ol><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">partitions</span> student;</code></pre><ol start="4"><li>查看分区表的结构</li></ol><pre><code class="hljs sql">desc formatted student;</code></pre><h3 id="二级分区"><a href="#二级分区" class="headerlink" title="二级分区"></a>二级分区</h3><ol><li>建表</li></ol><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student2(<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">string</span>) partitioned <span class="hljs-keyword">by</span> (<span class="hljs-keyword">month</span> <span class="hljs-keyword">string</span>,<span class="hljs-keyword">day</span> <span class="hljs-keyword">string</span>) <span class="hljs-keyword">row</span> <span class="hljs-keyword">format</span> <span class="hljs-keyword">delimited</span> <span class="hljs-keyword">fields</span> <span class="hljs-keyword">terminated</span> <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;\t&#x27;</span>;</code></pre><ol start="2"><li>导入本地数据</li></ol><pre><code class="hljs sql"><span class="hljs-keyword">load</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">local</span> inpath <span class="hljs-string">&#x27;/home/hadoop/data/student2.txt&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> student2 <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;2019-07&#x27;</span>,<span class="hljs-keyword">day</span>=<span class="hljs-string">&#x27;01&#x27;</span>);</code></pre><ol start="3"><li>查询</li></ol><pre><code class="hljs sql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student2 <span class="hljs-keyword">where</span> <span class="hljs-keyword">month</span> = <span class="hljs-string">&#x27;2019-07&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">day</span> = <span class="hljs-string">&#x27;01&#x27;</span>;</code></pre><pre><code> 4. 如果手动创建了一个分区文件夹，并上传文件，是不能直接查分区的，需要修复或者添加分区</code></pre><ul><li>修复指令（很多分区都没有添加）</li></ul><pre><code class="hljs sql">msck <span class="hljs-keyword">repair</span> <span class="hljs-keyword">table</span> student2;</code></pre><ul><li>添加分区（推荐）</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student2 <span class="hljs-keyword">add</span> <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span> = <span class="hljs-string">&#x27;2019-11&#x27;</span>,<span class="hljs-keyword">day</span> = <span class="hljs-string">&#x27;01&#x27;</span>)</code></pre><h1 id="DML数据操作"><a href="#DML数据操作" class="headerlink" title="DML数据操作"></a>DML数据操作</h1><h2 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h2><h3 id="1-向表中装载数据"><a href="#1-向表中装载数据" class="headerlink" title="1. 向表中装载数据"></a>1. 向表中装载数据</h3><pre><code class="hljs sql"><span class="hljs-keyword">load</span> <span class="hljs-keyword">data</span> [<span class="hljs-keyword">local</span>] inpath <span class="hljs-string">&#x27;xxx/xxx/xxx.txt&#x27;</span> overwrite|<span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> student [<span class="hljs-keyword">partition</span>(<span class="hljs-keyword">day</span>=<span class="hljs-string">&#x27;01&#x27;</span>,<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;201708&#x27;</span>]</code></pre><ul><li>local：本地或者hdfs</li></ul><h3 id="2-插入数据"><a href="#2-插入数据" class="headerlink" title="2. 插入数据"></a>2. 插入数据</h3><ul><li>基本插入</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;201702&#x27;</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ks&#x27;</span>)</code></pre><ul><li>覆盖插入</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> overwrite <span class="hljs-keyword">table</span> student <span class="hljs-keyword">partition</span>(<span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;20170208&#x27;</span>) <span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> <span class="hljs-keyword">month</span>=<span class="hljs-string">&#x27;201702&#x27;</span></code></pre><h3 id="3-创建表并加载数据"><a href="#3-创建表并加载数据" class="headerlink" title="3.创建表并加载数据"></a>3.创建表并加载数据</h3><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> student <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> student</code></pre><h3 id="3-导出数据"><a href="#3-导出数据" class="headerlink" title="3.导出数据"></a>3.导出数据</h3><h4 id="insert导出"><a href="#insert导出" class="headerlink" title="insert导出"></a>insert导出</h4><h5 id="1-将结果导出到本地"><a href="#1-将结果导出到本地" class="headerlink" title="1.将结果导出到本地"></a>1.将结果导出到本地</h5><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> overwrite <span class="hljs-keyword">local</span> <span class="hljs-keyword">directory</span> <span class="hljs-string">&#x27;/opt/module/datas/export/student&#x27;</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student;</code></pre><h5 id="2-将查询结果格式化导出到本地-hdfs上"><a href="#2-将查询结果格式化导出到本地-hdfs上" class="headerlink" title="2. 将查询结果格式化导出到本地/hdfs上"></a>2. 将查询结果格式化导出到本地/hdfs上</h5><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> overwrite [<span class="hljs-keyword">local</span>] <span class="hljs-keyword">directory</span> <span class="hljs-string">&#x27;/opt/module/datas/export/student1&#x27;</span> <span class="hljs-keyword">ROW</span> <span class="hljs-keyword">FORMAT</span> <span class="hljs-keyword">DELIMITED</span> <span class="hljs-keyword">FIELDS</span> <span class="hljs-keyword">TERMINATED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;\t&#x27;</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student;</code></pre><h4 id="hadoop导出"><a href="#hadoop导出" class="headerlink" title="hadoop导出"></a>hadoop导出</h4><pre><code class="hljs shell">hdfs dfs -get /user/hive/warehouse/student/month=20201125 /opt/module/datas/export/student3.txt</code></pre><ul><li>导出并合并</li></ul><pre><code class="hljs shell">hdfs dfs -getmerge /xxx /xxx/xxx.txt</code></pre><h4 id="sqoop导出"><a href="#sqoop导出" class="headerlink" title="sqoop导出"></a>sqoop导出</h4><ul><li>用于hive、mysql之间的导入导出</li></ul><h4 id="export导出"><a href="#export导出" class="headerlink" title="export导出"></a>export导出</h4><pre><code class="hljs shell">export table default.student to &#x27;/user/hive/warehouse/export/student&#x27;;</code></pre><h3 id="4-清空表"><a href="#4-清空表" class="headerlink" title="4. 清空表"></a>4. 清空表</h3><ul><li>注意：只能清空管理表，不能清空外部表</li></ul><pre><code class="hljs sql"><span class="hljs-keyword">truncate</span> <span class="hljs-keyword">table</span> default.student;</code></pre><h3 id="5-查询"><a href="#5-查询" class="headerlink" title="5. 查询"></a>5. 查询</h3>]]></content>
    
    
    
    <tags>
      
      <tag>hive</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo的安装以及常用命令</title>
    <link href="/2020/10/18/hexo/"/>
    <url>/2020/10/18/hexo/</url>
    
    <content type="html"><![CDATA[<h4 id="hexo常用命令"><a href="#hexo常用命令" class="headerlink" title="hexo常用命令"></a>hexo常用命令</h4><h5 id="新文章创建"><a href="#新文章创建" class="headerlink" title="新文章创建"></a>新文章创建</h5><pre><code class="hljs actionscript">hexo <span class="hljs-keyword">new</span> hexo</code></pre><h5 id="本地测试"><a href="#本地测试" class="headerlink" title="本地测试"></a>本地测试</h5><pre><code class="hljs sas">hexo clean <span class="hljs-variable">&amp;&amp;</span> hexo g <span class="hljs-variable">&amp;&amp;</span> hexo s</code></pre><h5 id="运行和部署-第一次应该提示用户名密码"><a href="#运行和部署-第一次应该提示用户名密码" class="headerlink" title="运行和部署(第一次应该提示用户名密码)"></a>运行和部署(第一次应该提示用户名密码)</h5><pre><code class="hljs 1c">hexo clean <span class="hljs-meta">&amp;&amp; hexo deploy</span></code></pre><h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><h5 id="安装node-js-、hexo"><a href="#安装node-js-、hexo" class="headerlink" title="安装node.js 、hexo"></a>安装node.js 、hexo</h5><h5 id="生成密钥，拷贝到github上"><a href="#生成密钥，拷贝到github上" class="headerlink" title="生成密钥，拷贝到github上"></a>生成密钥，拷贝到github上</h5><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span>-keygen -t rsa -b <span class="hljs-number">4096</span> -C <span class="hljs-string">&quot;cocoacm_liyiming@163.com&quot;</span></code></pre><h5 id="使用这个命令查看下"><a href="#使用这个命令查看下" class="headerlink" title="使用这个命令查看下"></a>使用这个命令查看下</h5><pre><code class="hljs nginx"><span class="hljs-attribute">ssh</span> -T git<span class="hljs-variable">@github</span>.com</code></pre><h5 id="个人的环境变量配置"><a href="#个人的环境变量配置" class="headerlink" title="个人的环境变量配置"></a>个人的环境变量配置</h5><pre><code class="hljs routeros">git<span class="hljs-built_in"> config </span>--global user.name <span class="hljs-string">&quot;kskuangshao&quot;</span>git<span class="hljs-built_in"> config </span>--global user.email <span class="hljs-string">&quot;cocoacm_liyiming@163.com&quot;</span></code></pre><h5 id="个人的环境变量配置创建仓库"><a href="#个人的环境变量配置创建仓库" class="headerlink" title="个人的环境变量配置创建仓库"></a>个人的环境变量配置创建仓库</h5><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/kskuangshao/</span>kskuangshao.github.io 这里一样  这里一样</code></pre><h5 id="安装deployer"><a href="#安装deployer" class="headerlink" title="安装deployer"></a>安装deployer</h5><pre><code class="hljs sql">npm <span class="hljs-keyword">install</span> hexo-deployer-git <span class="hljs-comment">--save</span></code></pre><h5 id="config-yml配置"><a href="#config-yml配置" class="headerlink" title="_config.yml配置"></a>_config.yml配置</h5><pre><code class="hljs less"><span class="hljs-attribute">deploy</span>:   <span class="hljs-attribute">type</span>: git   <span class="hljs-attribute">repo</span>: git<span class="hljs-variable">@github</span>.<span class="hljs-attribute">com</span>:kskuangshao/kskuangshao.github.io.git   <span class="hljs-attribute">branch</span>: master</code></pre><p><u>我觉得最大的坑就是配置文件，必须严格按照那特定的格式，可是官方文档也没特别提醒，必须是这个格式，type，repo，branch前两个空格，“：”后面一个空格，差一个都不行的：deploy:  type: git  repository: url  branch: master</u></p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2020/10/17/hello-world/"/>
    <url>/2020/10/17/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="hljs bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="hljs bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="hljs bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
